/*
  Copyright (c) [2023-2024] [AppLayer Developers]
  This software is distributed under the MIT License.
  See the LICENSE.txt file in the project root for more information.
*/

#include "../src/libs/catch2/catch_amalgamated.hpp"

#include "../src/contract/templates/snailtracer.h"

#include "../src/utils/uintconv.h"

#include "../sdktestsuite.hpp"

namespace TSNAILTRACERBENCHMARK {
  /*
   * Snailtracer Contract:
   * https://raw.githubusercontent.com/karalabe/snailtracer/master/snailtracer.sol
   */
  Bytes snailTracerBytecode = Hex::toBytes("6060604052341561000f57600080fd5b61477e8061001e6000396000f3006060604052600436106100615763ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166330627b7c811461006657806375ac892a146100c3578063784f136614610153578063c29436011461016f575b600080fd5b341561007157600080fd5b610079610185565b6040517fff00000000000000000000000000000000000000000000000000000000000000938416815291831660208301529091166040808301919091526060909101905180910390f35b34156100ce57600080fd5b6100dc600435602435612a7f565b60405160208082528190810183818151815260200191508051906020019080838360005b83811015610118578082015183820152602001610100565b50505050905090810190601f1680156101455780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561015e57600080fd5b610079600435602435604435612cb2565b341561017a57600080fd5b6100dc600435612cfa565b600080600080610193614430565b61019b614492565b6104006000556103006001556080604051908101604052806060604051908101604052806302faf08081526020016303197500815260200163119e7f80815250815260200161020c6060604051908101604052806000815260200161a673198152602001620f423f19815250612f4a565b8152600060208201819052604090910152600381518181518155602082015181600101556040820151816002015550506020820151600382018151815560208201518160010155604082015181600201555050604082015181600601556060820151600791909101805460ff1916911515919091179055506060604051908101604052806001546000546207d5dc028115156102a457fe5b058152600060208201819052604090910152600b815181556020820151816001015560408201516002909101555061034e61034561033c610337600b60606040519081016040908152825482526001830154602083015260029092015482820152906006906060905190810160405290816000820154815260200160018201548152602001600282015481525050612fd8565b612f4a565b6207d5dc613038565b620f4240613072565b600e8151815560208201518160010155604082015160029091015550601180546001810161037c83826144b4565b91600052602060002090600b0201600060a06040519081016040528064174876e8008152602001606060405190810160405280641748862a40815260200163026e8f0081526020016304dd1e00815250815260200160606040519081016040528060008152602001600081526020016000815250815260200160606040519081016040908152620b71b082526203d0906020808401829052918301529082520160009052919050815181556020820151600182018151815560208201518160010155604082015181600201555050604082015160048201815181556020820151816001015560408201518160020155505060608201516007820181518155602082015181600101556040820151816002015550506080820151600a8201805460ff191660018360028111156104ad57fe5b0217905550505050601180548060010182816104c991906144b4565b91600052602060002090600b0201600060a06040519081016040528064174876e800815260200160606040519081016040528064174290493f19815260200163026e8f0081526020016304dd1e0081525081526020016060604051908101604052806000815260200160008152602001600081525081526020016060604051908101604052806203d09081526020016203d0908152602001620b71b081525081526020016000600281111561057a57fe5b9052919050815181556020820151600182018151815560208201518160010155604082015181600201555050604082015160048201815181556020820151816001015560408201518160020155505060608201516007820181518155602082015181600101556040820151816002015550506080820151600a8201805460ff1916600183600281111561060957fe5b02179055505050506011805480600101828161062591906144b4565b91600052602060002090600b0201600060a06040519081016040528064174876e80081526020016060604051908101604052806302faf080815260200163026e8f00815260200164174876e800815250815260200160606040519081016040528060008152602001600081526020016000815250815260200160606040519081016040908152620b71b08083526020808401829052918301529082520160009052919050815181556020820151600182018151815560208201518160010155604082015181600201555050604082015160048201815181556020820151816001015560408201518160020155505060608201516007820181518155602082015181600101556040820151816002015550506080820151600a8201805460ff1916600183600281111561075357fe5b02179055505050506011805480600101828161076f91906144b4565b91600052602060002090600b0201600060a06040519081016040528064174876e80081526020016060604051908101604052806302faf080815260200163026e8f00815260200164173e54e97f1981525081526020016060604051908101604052806000815260200160008152602001600081525081526020016060604051908101604052806000815260200160008152602001600081525081526020016000600281111561081a57fe5b9052919050815181556020820151600182018151815560208201518160010155604082015181600201555050604082015160048201815181556020820151816001015560408201518160020155505060608201516007820181518155602082015181600101556040820151816002015550506080820151600a8201805460ff191660018360028111156108a957fe5b0217905550505050601180548060010182816108c591906144b4565b91600052602060002090600b0201600060a06040519081016040528064174876e80081526020016060604051908101604052806302faf080815260200164174876e80081526020016304dd1e00815250815260200160606040519081016040528060008152602001600081526020016000815250815260200160606040519081016040908152620b71b08083526020808401829052918301529082520160009052919050815181556020820151600182018151815560208201518160010155604082015181600201555050604082015160048201815181556020820151816001015560408201518160020155505060608201516007820181518155602082015181600101556040820151816002015550506080820151600a8201805460ff191660018360028111156109f357fe5b021790555050505060118054806001018281610a0f91906144b4565b91600052602060002090600b0201600060a06040519081016040528064174876e80081526020016060604051908101604052806302faf080815260200164174399c9ff1981526020016304dd1e00815250815260200160606040519081016040528060008152602001600081526020016000815250815260200160606040519081016040908152620b71b08083526020808401829052918301529082520160009052919050815181556020820151600182018151815560208201518160010155604082015181600201555050604082015160048201815181556020820151816001015560408201518160020155505060608201516007820181518155602082015181600101556040820151816002015550506080820151600a8201805460ff19166001836002811115610b3e57fe5b021790555050505060118054806001018281610b5a91906144b4565b91600052602060002090600b0201600060a06040519081016040528062fbc520815260200160606040519081016040528063019bfcc0815260200162fbc52081526020016302cd29c0815250815260200160606040519081016040528060008152602001600081526020016000815250815260200160606040519081016040908152620f3e588083526020808401829052918301529082520160019052919050815181556020820151600182018151815560208201518160010155604082015181600201555050604082015160048201815181556020820151816001015560408201518160020155505060608201516007820181518155602082015181600101556040820151816002015550506080820151600a8201805460ff19166001836002811115610c8457fe5b021790555050505060118054806001018281610ca091906144b4565b91600052602060002090600b0201600060a0604051908101604052806323c3460081526020016060604051908101604052806302faf080815260200163289c455081526020016304dd1e00815250815260200160606040519081016040528062b71b00815260200162b71b00815260200162b71b00815250815260200160606040519081016040528060008152602001600081526020016000815250815260200160006002811115610d4e57fe5b9052919050815181556020820151600182018151815560208201518160010155604082015181600201555050604082015160048201815181556020820151816001015560408201518160020155505060608201516007820181518155602082015181600101556040820151816002015550506080820151600a8201805460ff19166001836002811115610ddd57fe5b021790555050505060128054806001018281610df991906144e5565b9160005260206000209060130201600060e06040519081016040528060606040519081016040528063035e1f208152602001630188c2e081526020016304a62f808152508152602001606060405190810160405280630459e4408152602001630188c2e081526020016305a1f4a08152508152602001606060405190810160405280630459e44081526020016302f34f6081526020016304a62f80815250815260200160606040519081016040528060008152602001600081526020016000815250815260200160606040519081016040528060008152602001600081526020016000815250815260200160606040519081016040908152620f3e58808352602080840182905291830152908252016001905291905081518181518155602082015181600101556040820151816002015550506020820151600382018151815560208201518160010155604082015181600201555050604082015160068201815181556020820151816001015560408201518160020155505060608201516009820181518155602082015181600101556040820151816002015550506080820151600c8201815181556020820151816001015560408201518160020155505060a0820151600f8201815181556020820151816001015560408201518160020155505060c082015160128201805460ff19166001836002811115610ff857fe5b02179055505050506012805480600101828161101491906144e5565b9160005260206000209060130201600060e06040519081016040528060606040519081016040528063035e1f20815260200163016a8c8081526020016304a62f808152508152602001606060405190810160405280630459e4408152602001600081526020016304a62f808152508152602001606060405190810160405280630459e440815260200163016a8c8081526020016305a1f4a0815250815260200160606040519081016040528060008152602001600081526020016000815250815260200160606040519081016040528060008152602001600081526020016000815250815260200160606040519081016040908152620f3e58808352602080840182905291830152908252016001905291905081518181518155602082015181600101556040820151816002015550506020820151600382018151815560208201518160010155604082015181600201555050604082015160068201815181556020820151816001015560408201518160020155505060608201516009820181518155602082015181600101556040820151816002015550506080820151600c8201815181556020820151816001015560408201518160020155505060a0820151600f8201815181556020820151816001015560408201518160020155505060c082015160128201805460ff1916600183600281111561121057fe5b02179055505050506012805480600101828161122c91906144e5565b9160005260206000209060130201600060e060405190810160405280606060405190810160405280630555a9608152602001630188c2e081526020016304a62f808152508152602001606060405190810160405280630459e44081526020016302f34f6081526020016304a62f808152508152602001606060405190810160405280630459e4408152602001630188c2e081526020016305a1f4a0815250815260200160606040519081016040528060008152602001600081526020016000815250815260200160606040519081016040528060008152602001600081526020016000815250815260200160606040519081016040908152620f3e58808352602080840182905291830152908252016001905291905081518181518155602082015181600101556040820151816002015550506020820151600382018151815560208201518160010155604082015181600201555050604082015160068201815181556020820151816001015560408201518160020155505060608201516009820181518155602082015181600101556040820151816002015550506080820151600c8201815181556020820151816001015560408201518160020155505060a0820151600f8201815181556020820151816001015560408201518160020155505060c082015160128201805460ff1916600183600281111561142b57fe5b02179055505050506012805480600101828161144791906144e5565b9160005260206000209060130201600060e060405190810160405280606060405190810160405280630555a960815260200163016a8c8081526020016304a62f808152508152602001606060405190810160405280630459e440815260200163016a8c8081526020016305a1f4a08152508152602001606060405190810160405280630459e4408152602001600081526020016304a62f80815250815260200160606040519081016040528060008152602001600081526020016000815250815260200160606040519081016040528060008152602001600081526020016000815250815260200160606040519081016040908152620f3e58808352602080840182905291830152908252016001905291905081518181518155602082015181600101556040820151816002015550506020820151600382018151815560208201518160010155604082015181600201555050604082015160068201815181556020820151816001015560408201518160020155505060608201516009820181518155602082015181600101556040820151816002015550506080820151600c8201815181556020820151816001015560408201518160020155505060a0820151600f8201815181556020820151816001015560408201518160020155505060c082015160128201805460ff1916600183600281111561164357fe5b02179055505050506012805480600101828161165f91906144e5565b9160005260206000209060130201600060e06040519081016040528060606040519081016040528063035e1f208152602001630188c2e081526020016304a62f808152508152602001606060405190810160405280630459e44081526020016302f34f6081526020016304a62f808152508152602001606060405190810160405280630459e4408152602001630188c2e081526020016303aa6a60815250815260200160606040519081016040528060008152602001600081526020016000815250815260200160606040519081016040528060008152602001600081526020016000815250815260200160606040519081016040908152620f3e58808352602080840182905291830152908252016001905291905081518181518155602082015181600101556040820151816002015550506020820151600382018151815560208201518160010155604082015181600201555050604082015160068201815181556020820151816001015560408201518160020155505060608201516009820181518155602082015181600101556040820151816002015550506080820151600c8201815181556020820151816001015560408201518160020155505060a0820151600f8201815181556020820151816001015560408201518160020155505060c082015160128201805460ff1916600183600281111561185e57fe5b02179055505050506012805480600101828161187a91906144e5565b9160005260206000209060130201600060e06040519081016040528060606040519081016040528063035e1f20815260200163016a8c8081526020016304a62f808152508152602001606060405190810160405280630459e440815260200163016a8c8081526020016303aa6a608152508152602001606060405190810160405280630459e4408152602001600081526020016304a62f80815250815260200160606040519081016040528060008152602001600081526020016000815250815260200160606040519081016040528060008152602001600081526020016000815250815260200160606040519081016040908152620f3e58808352602080840182905291830152908252016001905291905081518181518155602082015181600101556040820151816002015550506020820151600382018151815560208201518160010155604082015181600201555050604082015160068201815181556020820151816001015560408201518160020155505060608201516009820181518155602082015181600101556040820151816002015550506080820151600c8201815181556020820151816001015560408201518160020155505060a0820151600f8201815181556020820151816001015560408201518160020155505060c082015160128201805460ff19166001836002811115611a7657fe5b021790555050505060128054806001018281611a9291906144e5565b9160005260206000209060130201600060e060405190810160405280606060405190810160405280630555a9608152602001630188c2e081526020016304a62f808152508152602001606060405190810160405280630459e4408152602001630188c2e081526020016303aa6a608152508152602001606060405190810160405280630459e44081526020016302f34f6081526020016304a62f80815250815260200160606040519081016040528060008152602001600081526020016000815250815260200160606040519081016040528060008152602001600081526020016000815250815260200160606040519081016040908152620f3e58808352602080840182905291830152908252016001905291905081518181518155602082015181600101556040820151816002015550506020820151600382018151815560208201518160010155604082015181600201555050604082015160068201815181556020820151816001015560408201518160020155505060608201516009820181518155602082015181600101556040820151816002015550506080820151600c8201815181556020820151816001015560408201518160020155505060a0820151600f8201815181556020820151816001015560408201518160020155505060c082015160128201805460ff19166001836002811115611c9157fe5b021790555050505060128054806001018281611cad91906144e5565b9160005260206000209060130201600060e060405190810160405280606060405190810160405280630555a960815260200163016a8c8081526020016304a62f808152508152602001606060405190810160405280630459e4408152602001600081526020016304a62f808152508152602001606060405190810160405280630459e440815260200163016a8c8081526020016303aa6a60815250815260200160606040519081016040528060008152602001600081526020016000815250815260200160606040519081016040528060008152602001600081526020016000815250815260200160606040519081016040908152620f3e58808352602080840182905291830152908252016001905291905081518181518155602082015181600101556040820151816002015550506020820151600382018151815560208201518160010155604082015181600201555050604082015160068201815181556020820151816001015560408201518160020155505060608201516009820181518155602082015181600101556040820151816002015550506080820151600c8201815181556020820151816001015560408201518160020155505060a0820151600f8201815181556020820151816001015560408201518160020155505060c082015160128201805460ff19166001836002811115611ea957fe5b021790555050505060128054806001018281611ec591906144e5565b9160005260206000209060130201600060e06040519081016040528060606040519081016040528063035e1f208152602001630188c2e081526020016304a62f808152508152602001606060405190810160405280630459e4408152602001630188c2e081526020016303aa6a608152508152602001606060405190810160405280630555a9608152602001630188c2e081526020016304a62f80815250815260200160606040519081016040528060008152602001600081526020016000815250815260200160606040519081016040528060008152602001600081526020016000815250815260200160606040519081016040908152620f3e58808352602080840182905291830152908252016001905291905081518181518155602082015181600101556040820151816002015550506020820151600382018151815560208201518160010155604082015181600201555050604082015160068201815181556020820151816001015560408201518160020155505060608201516009820181518155602082015181600101556040820151816002015550506080820151600c8201815181556020820151816001015560408201518160020155505060a0820151600f8201815181556020820151816001015560408201518160020155505060c082015160128201805460ff191660018360028111156120c457fe5b0217905550505050601280548060010182816120e091906144e5565b9160005260206000209060130201600060e06040519081016040528060606040519081016040528063035e1f208152602001630188c2e081526020016304a62f808152508152602001606060405190810160405280630555a9608152602001630188c2e081526020016304a62f808152508152602001606060405190810160405280630459e4408152602001630188c2e081526020016305a1f4a0815250815260200160606040519081016040528060008152602001600081526020016000815250815260200160606040519081016040528060008152602001600081526020016000815250815260200160606040519081016040908152620f3e58808352602080840182905291830152908252016001905291905081518181518155602082015181600101556040820151816002015550506020820151600382018151815560208201518160010155604082015181600201555050604082015160068201815181556020820151816001015560408201518160020155505060608201516009820181518155602082015181600101556040820151816002015550506080820151600c8201815181556020820151816001015560408201518160020155505060a0820151600f8201815181556020820151816001015560408201518160020155505060c082015160128201805460ff191660018360028111156122df57fe5b0217905550505050601280548060010182816122fb91906144e5565b9160005260206000209060130201600060e06040519081016040528060606040519081016040528063035e1f20815260200163016a8c8081526020016304a62f808152508152602001606060405190810160405280630555a960815260200163016a8c8081526020016304a62f808152508152602001606060405190810160405280630459e440815260200163016a8c8081526020016303aa6a60815250815260200160606040519081016040528060008152602001600081526020016000815250815260200160606040519081016040528060008152602001600081526020016000815250815260200160606040519081016040908152620f3e58808352602080840182905291830152908252016001905291905081518181518155602082015181600101556040820151816002015550506020820151600382018151815560208201518160010155604082015181600201555050604082015160068201815181556020820151816001015560408201518160020155505060608201516009820181518155602082015181600101556040820151816002015550506080820151600c8201815181556020820151816001015560408201518160020155505060a0820151600f8201815181556020820151816001015560408201518160020155505060c082015160128201805460ff191660018360028111156124fa57fe5b02179055505050506012805480600101828161251691906144e5565b9160005260206000209060130201600060e06040519081016040528060606040519081016040528063035e1f20815260200163016a8c8081526020016304a62f808152508152602001606060405190810160405280630459e440815260200163016a8c8081526020016305a1f4a08152508152602001606060405190810160405280630555a960815260200163016a8c8081526020016304a62f80815250815260200160606040519081016040528060008152602001600081526020016000815250815260200160606040519081016040528060008152602001600081526020016000815250815260200160606040519081016040908152620f3e58808352602080840182905291830152908252016001905291905081518181518155602082015181600101556040820151816002015550506020820151600382018151815560208201518160010155604082015181600201555050604082015160068201815181556020820151816001015560408201518160020155505060608201516009820181518155602082015181600101556040820151816002015550506080820151600c8201815181556020820151816001015560408201518160020155505060a0820151600f8201815181556020820151816001015560408201518160020155505060c082015160128201805460ff1916600183600281111561271557fe5b0217905550505050600092505b60125483101561291c57601280548490811061273a57fe5b906000526020600020906013020160e06040519081016040529081600082016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600382016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600682016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600982016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600c82016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600f82016060604051908101604090815282548252600183015460208084019190915260029384015491830191909152908352601284015492019160ff169081111561289c57fe5b60028111156128a757fe5b90525091506128d56103376128c1602085015185516130c6565b6128d0856040015186516130c6565b612fd8565b60128054859081106128e357fe5b90600052602060002090601302016009016000820151815560208201518160010155604082015160029091015550600190920191612722565b6060604051908101604052806001546000546207d5dc0281151561293c57fe5b058152600060208201819052604090910152600b81518155602082015181600101556040820151600290910155506129cf61034561033c610337600b60606040519081016040908152825482526001830154602083015260029092015482820152906006906060905190810160405290816000820154815260200160018201548152602001600282015481525050612fd8565b600e8151815560208201518160010155604082015160029091015550612a04816129ff6102006101806008613108565b6132ec565b9050612a1a816129ff61014561021c6008613108565b9050612a2e816129ff610258806008613108565b9050612a44816129ff61020a61020c6008613108565b9050612a51816004613072565b9050805160f860020a02816020015160f860020a02826040015160f860020a02955095509550505050909192565b612a87614511565b6000612a91614492565b600091505b600054821215612c0d57612aab828686613108565b9050600280546001816001161561010002031660029004806001018281612ad29190614523565b9190815460011615612af35790600052602060002090602091828204019190065b835160f860020a0290919091601f036101000a81548160ff0219169060f860020a8404021790555050600280546001816001161561010002031660029004806001018281612b419190614523565b9190815460011615612b625790600052602060002090602091828204019190065b836020015160f860020a0290919091601f036101000a81548160ff0219169060f860020a8404021790555050600280546001816001161561010002031660029004806001018281612bb39190614523565b9190815460011615612bd45790600052602060002090602091828204019190065b836040015160f860020a0290919091601f036101000a81548160ff0219169060f860020a84040217905550508180600101925050612a96565b60028054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015612ca35780601f10612c7857610100808354040283529160200191612ca3565b820191906000526020600020905b815481529060010190602001808311612c8657829003601f168201915b50505050509250505092915050565b6000806000612cbf614492565b612cca878787613108565b9050805160f860020a02816020015160f860020a02826040015160f860020a029350935093505093509350939050565b612d02614511565b600080612d0d614492565b600180540392505b60008312612ea557600091505b600054821215612e9957612d37828487613108565b9050600280546001816001161561010002031660029004806001018281612d5e9190614523565b9190815460011615612d7f5790600052602060002090602091828204019190065b835160f860020a0290919091601f036101000a81548160ff0219169060f860020a8404021790555050600280546001816001161561010002031660029004806001018281612dcd9190614523565b9190815460011615612dee5790600052602060002090602091828204019190065b836020015160f860020a0290919091601f036101000a81548160ff0219169060f860020a8404021790555050600280546001816001161561010002031660029004806001018281612e3f9190614523565b9190815460011615612e605790600052602060002090602091828204019190065b836040015160f860020a0290919091601f036101000a81548160ff0219169060f860020a84040217905550508180600101925050612d22565b60001990920191612d15565b60028054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015612f3b5780601f10612f1057610100808354040283529160200191612f3b565b820191906000526020600020905b815481529060010190602001808311612f1e57829003601f168201915b50505050509350505050919050565b612f52614492565b6000612f79836040015184604001510284602001518560200151028551865102010161332e565b9050606060405190810160405280828551620f424002811515612f9857fe5b058152602001828560200151620f424002811515612fb257fe5b058152602001828560400151620f424002811515612fcc57fe5b05905291505b50919050565b612fe0614492565b6060604051908101604052808360200151856040015102846040015186602001510203815260200183604001518551028451866040015102038152602001835185602001510284602001518651020390529392505050565b613040614492565b606060405190810160405280845184028152602001846020015184028152602001846040015184029052905092915050565b61307a614492565b60606040519081016040528083855181151561309257fe5b0581526020018385602001518115156130a757fe5b0581526020018385604001518115156130bc57fe5b0590529392505050565b6130ce614492565b6060604051908101604052808351855103815260200183602001518560200151038152602001836040015185604001510390529392505050565b613110614492565b600061311a614492565b6131226145e6565b6000546013805463ffffffff1916918802890163ffffffff16919091179055613149614492565b9350600092505b848312156132cb5761323c61320b6103456131d0600b6060604051908101604052908160008201548152602001600182015481526020016002820154815250506207a1206000546207a1206131a3613363565b63ffffffff168115156131b257fe5b0663ffffffff168e620f424002018115156131c957fe5b0503613038565b6129ff600e606060405190810160409081528254825260018084015460208401526002909301549082015290546207a12090816131a3613363565b60066060604051908101604052908160008201548152602001600182015481526020016002820154815250506132ec565b915060806040519081016040528061328760036000016060604051908101604052908160008201548152602001600182015481526020016002820154815250506129ff86608c613038565b815260200161329584612f4a565b815260006020820181905260409091015290506132be846129ff6132b88461338d565b88613072565b9350600190920191613150565b6132e16103456132da866137d7565b60ff613038565b979650505050505050565b6132f4614492565b6060604051908101604052808351855101815260200183602001518560200151018152602001836040015185604001510190529392505050565b80600260018201055b81811215612fd257809150600281828581151561335057fe5b050181151561335b57fe5b059050613337565b6013805463ffffffff19811663ffffffff9182166341c64e6d026130390182161791829055165b90565b613395614492565b60008060006133a261461c565b6133aa614430565b6133b2614492565b6133ba614492565b60006133c4614492565b600a8b6040015113156133f7576060604051908101604052806000815260200160008152602001600081525099506137c9565b6134008b613823565b919a5098509650881515613434576060604051908101604052806000815260200160008152602001600081525099506137c9565b600088600181111561344257fe5b141561354c57601180548890811061345657fe5b90600052602060002090600b020160a0604051908101604052908160008201548152602001600182016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600482016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600782016060604051908101604090815282548252600183015460208084019190915260029384015491830191909152908352600a84015492019160ff169081111561352957fe5b600281111561353457fe5b905250955060608601519350856040015192506136db565b601280548890811061355a57fe5b906000526020600020906013020160e06040519081016040529081600082016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600382016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600682016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600982016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600c82016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600f82016060604051908101604090815282548252600183015460208084019190915260029384015491830191909152908352601284015492019160ff16908111156136bc57fe5b60028111156136c757fe5b905250945060a08501519350846080015192505b6001915081846040015113156136f357836040015191505b818460200151131561370757836020015191505b818460400151131561371b57836040015191505b8a60400180516001019052600560408c015113156137815781620f4240613740613363565b63ffffffff1681151561374f57fe5b0663ffffffff1612156137795761377261376c85620f4240613038565b83613072565b9350613781565b8299506137c9565b600088600181111561378f57fe5b14156137a7576137a08b878b613b3d565b90506137b5565b6137b28b868b613be2565b90505b6137c6836129ff6103458785613cae565b99505b505050505050505050919050565b6137df614492565b6060604051908101604052806137f58451613cf0565b81526020016138078460200151613cf0565b81526020016138198460400151613cf0565b905290505b919050565b6000808080808080805b6011548210156139645761393060118381548110151561384957fe5b90600052602060002090600b020160a0604051908101604052908160008201548152602001600182016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600482016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600782016060604051908101604090815282548252600183015460208084019190915260029384015491830191909152908352600a84015492019160ff169081111561391c57fe5b600281111561392757fe5b9052508a613d1b565b9050600081138015613949575084158061394957508481125b1561395957809450600093508192505b60019091019061382d565b600091505b601254821015613b2f57613afb60128381548110151561398557fe5b906000526020600020906013020160e06040519081016040529081600082016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600382016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600682016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600982016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600c82016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600f82016060604051908101604090815282548252600183015460208084019190915260029384015491830191909152908352601284015492019160ff1690811115613ae757fe5b6002811115613af257fe5b9052508a613dc4565b9050600081138015613b145750841580613b1457508481125b15613b2457809450600193508192505b600190910190613969565b509297919650945092505050565b613b45614492565b613b4d614492565b613b55614492565b613b6b86516129ff610345896020015188613038565b9150613b7e6103378387602001516130c6565b9050600085608001516002811115613b9257fe5b1415613bce576000613ba8828860200151613f2b565b12613bbc57613bb981600019613038565b90505b613bc7868383613f51565b9250613bd9565b613bc78683836140ed565b50509392505050565b613bea614492565b613bf2614492565b60008080613c0c88516129ff6103458b602001518a613038565b9350620a2c2a9250876060015115613c25576216e36092505b620f4240613c3b88606001518a60200151613f2b565b811515613c4457fe5b05915060008212613c56578160000391505b64e8d4a510008380028380028203020564e8d4a510000390506000811215613c8e57613c87888589606001516140ed565b9450613ca3565b613ca08885896060015186868661416d565b94505b505050509392505050565b613cb6614492565b6060604051908101604052808351855102815260200183602001518560200151028152602001836040015185604001510290529392505050565b600080821215613d025750600061381e565b620f4240821315613d175750620f424061381e565b5090565b6000613d25614492565b600080613d37866020015186516130c6565b9250620f4240613d4b848760200151613f2b565b811515613d5457fe5b0591508551865102613d668485613f2b565b838402030190506000811215613d7f5760009350613dbb565b613d888161332e565b90506103e88183031315613da0578082039350613dbb565b6103e88183011315613db6578082019350613dbb565b600093505b50505092915050565b6000613dce614492565b613dd6614492565b613dde614492565b6000613de8614492565b6000613df2614492565b600080613e048c602001518d516130c6565b9850613e158c604001518d516130c6565b9750613e258b6020015189612fd8565b9650620f4240613e358a89613f2b565b811515613e3e57fe5b0595506103e71986138015613e5457506103e886125b15613e625760009950613f1c565b613e6e8b518d516130c6565b945085613e7b8689613f2b565b811515613e8457fe5b0593506000841280613e985750620f424084135b15613ea65760009950613f1c565b613eb0858a612fd8565b925085613ec18c6020015185613f2b565b811515613eca57fe5b0591506000821280613ee05750620f4240828501135b15613eee5760009950613f1c565b85613ef98985613f2b565b811515613f0257fe5b0590506103e8811215613f185760009950613f1c565b8099505b50505050505050505092915050565b600081604001518360400151028260200151846020015102835185510201019392505050565b613f59614492565b6000806000613f66614492565b613f6e614492565b620f424080613f7b613363565b63ffffffff16811515613f8a57fe5b0663ffffffff16625fdfb002811515613f9f57fe5b059450620f4240613fae613363565b63ffffffff16811515613fbd57fe5b0663ffffffff169350613fcf8461332e565b6103e8029250620186a0613fe3885161435e565b13156140115760606040519081016040528060008152602001620f4240815260200160008152509150614035565b606060405190810160405280620f4240815260200160008152602001600081525091505b6140426103378389612fd8565b91506140516103378884612fd8565b90506140ab61033761409061407e85620f42408861406e8c614376565b0281151561407857fe5b05613038565b6129ff85620f42408961406e8d61439d565b6129ff8a6140a289620f42400361332e565b6103e802613038565b91506140e06080604051908101604052808a81526020018481526020018b6040015181526020018b606001511515905261338d565b9998505050505050505050565b6140f5614492565b6140fd614492565b61412f610337866020015161412a86620f424061411e898c60200151613f2b565b60020281151561407857fe5b6130c6565b90506141646080604051908101604052808681526020018381526020018760400151815260200187606001511515905261338d565b95945050505050565b614175614492565b600061417f614492565b60008060001993508a606001511561419657600193505b6141d36103376103456141ad8e602001518c613038565b61412a8d6141ba8c61332e565b620f42408f8f028115156141ca57fe5b05018a02613038565b925086620f42400191508a60600151151561420857620f42406141f6848b613f2b565b8115156141ff57fe5b05620f42400391505b50619c406c0c9f2c9cd04674edea40000000620ea600838002840284028402020501600260408c0151136142a65761427661426b6080604051908101604052808d81526020018681526020018e6040015181526020018e6060015115905261338d565b82620f424003613038565b9250614290836129ff61428a8e8e8e6140ed565b84613038565b925061429f83620f4240613072565b9450614350565b600281056203d09001620f42406142bb613363565b63ffffffff168115156142ca57fe5b0663ffffffff1612156142fc5761429f6142ee6142e88d8d8d6140ed565b83613038565b600283056203d09001613072565b61434d61433f6143346080604051908101604052808e81526020018781526020018f6040015181526020018f6060015115905261338d565b83620f424003613038565b60028305620b71b003613072565b94505b505050509695505050505050565b60008082131561436f57508061381e565b5060000390565b6000806143828361439d565b905061439681820264e8d4a510000361332e565b9392505050565b60008060008060005b60008612156143bc57625fdfb0860195506143a6565b5b625fdfb086126143d457625fdfb0860395506143bd565b506001925084915082905060025b8183131561442757818385028115156143f757fe5b059490940193620f42408684028702819005600019959095029405925060018101810291909102906002016143e2565b50505050919050565b61026060405190810160405280614445614492565b8152602001614452614492565b815260200161445f614492565b815260200161446c614492565b8152602001614479614492565b8152602001614486614492565b81526020016000905290565b6060604051908101604052806000815260200160008152602001600081525090565b8154818355818115116144e057600b0281600b0283600052602060002091820191016144e09190614638565b505050565b8154818355818115116144e0576013028160130283600052602060002091820191016144e0919061469c565b60206040519081016040526000815290565b81546001816001161561010002031660029004825481601f1061457e5782601f10614563575b826008026101000360020a809104028280011783556144e0565b60ff19168360005260206000205581800160010183556144e0565b82601f106145ae575082600052602060002080549082601f01602090048101906145a89190614738565b50614549565b508180016001018355818115116144e057601f016020900481601f016020900483600052602060002091820191016144e09190614738565b610100604051908101604052806145fb614492565b8152602001614608614492565b815260006020820181905260409091015290565b610160604051908101604052806000815260200161446c614492565b61338a91905b80821115613d1757600080825560018201819055600282018190556003820181905560048201819055600582018190556006820181905560078201819055600882018190556009820155600a8101805460ff19169055600b0161463e565b61338a91905b80821115613d17576000808255600182018190556002820181905560038201819055600482018190556005820181905560068201819055600782018190556008820181905560098201819055600a8201819055600b8201819055600c8201819055600d8201819055600e8201819055600f820181905560108201819055601182015560128101805460ff191690556013016146a2565b61338a91905b80821115613d17576000815560010161473e5600a165627a7a72305820ac045af5cd8356946239ae8ac790f3372e93b574f48a58a7e22a0f58e6be79940029");

  TEST_CASE("SnailTracer Benchmark", "[benchmark]") {
    SECTION("CPP SnailTracer Benchmark") {
      std::unique_ptr<Options> options = nullptr;
      Address to(Utils::randBytes(20));

      SDKTestSuite sdk = SDKTestSuite::createNewEnvironment("testSnailTracerCppBenchmark");
      // const TestAccount& from, const Address& to, const uint256_t& value, Bytes data = Bytes()
      auto snailtracerAddress = sdk.deployContract<SnailTracer>(int256_t(1024), int256_t(768));
      // Now for the funny part, we are NOT a C++ contract, but we can
      // definitely take advantage of the templated ABI to interact with it
      // as the encoding is the same

      // Create the transaction for transfer
      auto functor = UintConv::uint32ToBytes(ABI::FunctorEncoder::encode("Benchmark").value);
      Bytes benchmarkEncoded(functor.cbegin(), functor.cend());
      //Utils::appendBytes(benchmarkEncoded, ABI::Encoder::encodeData<int256_t, int256_t>(1024, 768)); // TODO: this is a bug, the function does not take any params yet it is called with them just fine
      TxBlock benchmarkTx = sdk.createNewTx(sdk.getChainOwnerAccount(), snailtracerAddress, 0, benchmarkEncoded);

      auto& state = sdk.getState();
      evmc_tx_context txContext;

      txContext.tx_origin = sdk.getChainOwnerAccount().address.toEvmcAddress();
      txContext.tx_gas_price = {};
      txContext.block_coinbase = to.toEvmcAddress();
      txContext.block_number = 1;
      txContext.block_timestamp = 1;
      txContext.block_gas_limit = std::numeric_limits<int64_t>::max();
      txContext.block_prev_randao = {};
      txContext.chain_id = {};
      txContext.block_base_fee = {};
      txContext.blob_base_fee = {};
      txContext.blob_hashes = nullptr;
      txContext.blob_hashes_count = 0;

      auto callInfo = benchmarkTx.txToMessage();
      Hash randomnessHash = Hash::random();
      int64_t leftOverGas = std::numeric_limits<int64_t>::max();

      auto start = std::chrono::high_resolution_clock::now();
      state.call(callInfo, txContext, ContractType::CPP, randomnessHash, randomnessHash, randomnessHash, leftOverGas);
      auto end = std::chrono::high_resolution_clock::now();

      long double durationInMicroseconds = std::chrono::duration_cast<std::chrono::microseconds>(end - start).count();

      std::cout << "CPP SnailTracer Total Time: " << durationInMicroseconds << " microseconds" << std::endl;

      // Dump the state
      sdk.getState().saveToDB();
    }

    SECTION("EVM SnailTracer Benchmark") {
      std::unique_ptr<Options> options = nullptr;
      Address to(Utils::randBytes(20));

      auto sdk = SDKTestSuite::createNewEnvironment("testSnailTracerEvmBenchmark");

      auto snailtracerAddress = sdk.deployBytecode(snailTracerBytecode);
      // Create the transaction for transfer
      auto functor = UintConv::uint32ToBytes(ABI::FunctorEncoder::encode("Benchmark").value);
      Bytes benchmarkEncoded(functor.cbegin(), functor.cend());
      //Utils::appendBytes(benchmarkEncoded, ABI::Encoder::encodeData<int256_t, int256_t>(1024, 768)); // TODO: this is a bug, the function does not take any params yet it is called with them just fine

      TxBlock benchmarkTx = sdk.createNewTx(sdk.getChainOwnerAccount(), snailtracerAddress, 0, benchmarkEncoded);
      auto& state = sdk.getState();
      evmc_tx_context txContext;

      txContext.tx_origin = sdk.getChainOwnerAccount().address.toEvmcAddress();
      txContext.tx_gas_price = {};
      txContext.block_coinbase = to.toEvmcAddress();
      txContext.block_number = 1;
      txContext.block_timestamp = 1;
      txContext.block_gas_limit = std::numeric_limits<int64_t>::max();
      txContext.block_prev_randao = {};
      txContext.chain_id = {};
      txContext.block_base_fee = {};
      txContext.blob_base_fee = {};
      txContext.blob_hashes = nullptr;
      txContext.blob_hashes_count = 0;

      auto callInfo = benchmarkTx.txToMessage();
      Hash randomnessHash = Hash::random();
      int64_t leftOverGas = std::numeric_limits<int64_t>::max();

      auto start = std::chrono::high_resolution_clock::now();
      state.call(callInfo, txContext, ContractType::EVM, randomnessHash, randomnessHash, randomnessHash, leftOverGas);
      auto end = std::chrono::high_resolution_clock::now();

      long double durationInMicroseconds = std::chrono::duration_cast<std::chrono::microseconds>(end - start).count();
      std::cout << "EVM SnailTracer Total Time: " << durationInMicroseconds << " microseconds" << std::endl;

      // Dump the state
      sdk.getState().saveToDB();
    }
  }
}
