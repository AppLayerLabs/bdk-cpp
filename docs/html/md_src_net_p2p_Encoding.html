<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OrbiterSDK: P2P Encoding.</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">OrbiterSDK<span id="projectnumber">&#160;1</span>
   </div>
   <div id="projectbrief">Subnet from Sparq Labs</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title"><a class="el" href="namespaceP2P.html" title="Forward Declaration.">P2P</a> Encoding. </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="autotoc_md7"></a>
P2P Handshake</h2>
<p >The <a class="el" href="namespaceP2P.html" title="Forward Declaration.">P2P</a> WebSocket handshake is done through a HTTP request, meaning we can include extra information within that HTTP header. We encode the following information within the HTTP header:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Header   </th><th class="markdownTableHeadNone">Info    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">X-Node-Id   </td><td class="markdownTableBodyNone">Host node ID    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">X-Node-Type   </td><td class="markdownTableBodyNone">Host node Type    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">X-Node-ServerPort   </td><td class="markdownTableBodyNone">Host node Server Port   </td></tr>
</table>
<p >The HTTP encoding has to follow certain rules, such as being UTF-8 encoded (cannot send raw bytes), because of that, X-Node-Id is a hex string, X-Node-Type and X-Node-ServerPort are a string number (e.g. "8080")</p>
<hr  />
 <h2><a class="anchor" id="autotoc_md9"></a>
P2P::Message</h2>
<p >structure that holds any type of <a class="el" href="namespaceP2P.html" title="Forward Declaration.">P2P</a> Message, it is encoded as following:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Variable   </th><th class="markdownTableHeadNone">Size   </th><th class="markdownTableHeadNone">Info    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Request Flag   </td><td class="markdownTableBodyNone">1 Byte   </td><td class="markdownTableBodyNone">Request Type (Answer, request or broadcast)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Random ID   </td><td class="markdownTableBodyNone">8 Bytes   </td><td class="markdownTableBodyNone">Request ID    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Command ID   </td><td class="markdownTableBodyNone">2 Bytes   </td><td class="markdownTableBodyNone">Command ID    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Payload   </td><td class="markdownTableBodyNone">X Bytes   </td><td class="markdownTableBodyNone">Message Command Payload   </td></tr>
</table>
<p >All hexes displayed in this document are interpreted as bytes</p>
<ul>
<li>Request Flag</li>
</ul>
<p >Used to tell if the request is a "request" (0), an "answer" (1) to a previous "request", or a "broadcast" (2) request (verify and broadcast towards other nodes of the network)</p>
<p >A Request will always wait and have an respective Answer while broadcast are processed directly, see the difference between functions called by handleAnswer/handleRequest and functions called by handleBroadcast. the randomId of the broadcast request is used to know if the node has previously received that broadcast and if it should broadcast again.</p>
<ul>
<li>Random ID</li>
</ul>
<p >Used to tell different requests appart and to make async requests, during a request, the randomId is calculated with 8 random bytes, during a answer, the randomId is equal to the randomId of the respective request, if broadcast request, RandomID = <a class="el" href="structSafeHash.html" title="Custom hashing implementation for use in std::unordered_map.">SafeHash(payload)</a>.</p>
<ul>
<li>Command ID</li>
</ul>
<p >Used to tell which command type is encoded in the payload, see more info below</p>
<ul>
<li>Payload</li>
</ul>
<p >Used for payload of the request/answer (if needed)</p>
<p >Given the example <code>0x01adf01827349cad810002123456789abcdef</code> we can extract the following values:</p><ul>
<li>Request Flag: 01</li>
<li>Random ID: adf01827349cad81</li>
<li>Command ID: 0002</li>
<li>Payload: 123456789abcdef</li>
</ul>
<hr  />
 <h1><a class="anchor" id="autotoc_md11"></a>
Commands</h1>
<h2><a class="anchor" id="autotoc_md12"></a>
Ping</h2>
<p >Pings another node.</p>
<p >Ping command ID: \x00\x00</p>
<p >Request Type: Answer or Request only, No broadcast.</p>
<p >Request Payload: Empty</p>
<p >Request example: <code>0x00adf01827349cad810000</code></p>
<p >Answer Payload: Empty</p>
<p >Answer Example: <code>0x01adf01827349cad810000</code></p>
<hr  />
 <h2><a class="anchor" id="autotoc_md14"></a>
Info</h2>
<p >Requests a basic list of information from another node, also sends ours.</p>
<p >Ping Command ID: \x00\x01</p>
<p >Request Type: Answer or Request only, No broadcast</p>
<p >Request Payload: Node version + Epoch + latest nHeight + latest nHash + nConnectedNodes</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Variable   </th><th class="markdownTableHeadNone">Size   </th><th class="markdownTableHeadNone">Info    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">version   </td><td class="markdownTableBodyNone">8 Bytes   </td><td class="markdownTableBodyNone">Node Version    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Epoch   </td><td class="markdownTableBodyNone">8 Bytes   </td><td class="markdownTableBodyNone">Timestamp in UNIX microseconds    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">nHeight   </td><td class="markdownTableBodyNone">8 Bytes   </td><td class="markdownTableBodyNone">latest block nHeight    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="classHash.html" title="Abstraction of a 32-byte hash. Inherits FixedStr&lt;32&gt;.">Hash</a>   </td><td class="markdownTableBodyNone">32 Bytes   </td><td class="markdownTableBodyNone">latest block hash   </td></tr>
</table>
<p >Request Example: <code>0x00adf01827349cad81000100000000000000010005f70436085980000000000000000156aef6ce3d9cefb653ea6a53fc8e810c95268c01428223a8ee267ed2ac9f05d8</code></p>
<p >Answer Payload: same as request.</p>
<hr  />
 <h2><a class="anchor" id="autotoc_md16"></a>
requestNodes</h2>
<p >Request a list of connected nodes to a given node.</p>
<p >requestNodes command ID: \x00\x02</p>
<p >Request Type: Answer or Request only, No broadcast.</p>
<p >Request Payload: empty</p>
<p >Request Example: <code>0x00adf01827349cad810002</code></p>
<p >Answer Payload: Array of address type + address + port (only connections towards servers)</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Variable   </th><th class="markdownTableHeadNone">Size   </th><th class="markdownTableHeadNone">Info    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Node Type (Repeatable)   </td><td class="markdownTableBodyNone">1 Byte   </td><td class="markdownTableBodyNone">Node Type (Normal or Discovery)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Node ID (Repetable)   </td><td class="markdownTableBodyNone">32 Bytes   </td><td class="markdownTableBodyNone">Node ID    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Type (Repeatable)   </td><td class="markdownTableBodyNone">1 byte   </td><td class="markdownTableBodyNone"><a class="el" href="classAddress.html" title="Abstraction for a single 20-byte address (e.g. &quot;1234567890abcdef...&quot;). Inherits FixedStr&lt;20&gt;.">Address</a> type (v4 or v6)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="classAddress.html" title="Abstraction for a single 20-byte address (e.g. &quot;1234567890abcdef...&quot;). Inherits FixedStr&lt;20&gt;.">Address</a> (Repeatable)   </td><td class="markdownTableBodyNone">4 or 16 Bytes   </td><td class="markdownTableBodyNone"><a class="el" href="classAddress.html" title="Abstraction for a single 20-byte address (e.g. &quot;1234567890abcdef...&quot;). Inherits FixedStr&lt;20&gt;.">Address</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Port (Repetable)   </td><td class="markdownTableBodyNone">2 Bytes   </td><td class="markdownTableBodyNone">Node Server Port   </td></tr>
</table>
<p >Example, node has connections to servers 127.0.0.1:8080 and 127.0.0.1:8081 and gets requested with a requestNodes, it will encode an address as following, <a class="el" href="classAddress.html" title="Abstraction for a single 20-byte address (e.g. &quot;1234567890abcdef...&quot;). Inherits FixedStr&lt;20&gt;.">Address</a> = <code>Bytes(NodeType) + Bytes(NodeID) + "0x00"/"0x01" depending on address type + Bytes(address) + Bytes(port)</code>, the total encoded string will be <code>Answer + RandomID + Command ID + Address¹ + Address²</code></p>
<p >Normal Node at 127.0.0.1:8080, Node ID = 71fb09a7e9dc4fd2a85797bc92080d49ead60ebaa2b562d817bdfb31bc258134, encoded <code>0x0071fb09a7e9dc4fd2a85797bc92080d49ead60ebaa2b562d817bdfb31bc258134007f0000011f90</code></p>
<p >Discovery Node 127.0.0.1:8081, Node ID = 28fbed1f738503d325acfede76f1d96f0f7d2d4ca7148170d824b9f00c420a5a, Encoded <code>0x0128fbed1f738503d325acfede76f1d96f0f7d2d4ca7148170d824b9f00c420a5a007f0000011f91</code></p>
<p >Total encoded string = <code>0x00adf01827349cad8100020071fb09a7e9dc4fd2a85797bc92080d49ead60ebaa2b562d817bdfb31bc258134007f0000011f900128fbed1f738503d325acfede76f1d96f0f7d2d4ca7148170d824b9f00c420a5a007f0000011f91</code></p>
<hr  />
 <h2><a class="anchor" id="autotoc_md18"></a>
RequestValidatorTxs</h2>
<p >Request <a class="el" href="classTxValidator.html" title="Abstraction of a Validator transaction.">TxValidator</a> memory pool of another node.</p>
<p >requestNodes command ID: \x00\x03</p>
<p >Request Type: Answer or Request only, No broadcast.</p>
<p >Request Payload: empty</p>
<p >Request Example: <code>0x00adf01827349cad810003</code></p>
<p >Answer Payload: nTxCount + [ 4 Bytes tx size + N Bytes Tx data ]\x00\x04</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Variable   </th><th class="markdownTableHeadNone">Size   </th><th class="markdownTableHeadNone">Info    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">nTx   </td><td class="markdownTableBodyNone">4 Byte   </td><td class="markdownTableBodyNone">Tx Counter    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">TxSize (Repeatable)   </td><td class="markdownTableBodyNone">4 Bytes   </td><td class="markdownTableBodyNone">Tx Size    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">TxData (Repeatable)   </td><td class="markdownTableBodyNone">N byte   </td><td class="markdownTableBodyNone">Transaction RLP encoded data   </td></tr>
</table>
<p >Example, node has two transactions within mempool with the following rlp </p><div class="fragment"><div class="line"> {f86ba4cfffe74621e0caa14dfcb67a6f263391f4a6ad957ace256f3e706b6da07517a63295165701823f44a08cfdf3826149ca0317eaf4f5832c867a4f5050e3e70d635323947d61a4f35618a07dbe86e6a8cef509c7c6174cb8c703ddd8cb695511d72043630d99888ff2ba20```}</div>
<div class="line">and ```f86ba4cfffe74621e0caa14dfcb67a6f263391f4a6ad957ace256f3e706b6da07517a63295165701823f44a01545c0c89ad5fda9e4c6ef65f264ef575fa2edebef29d577f88d365ff9d28357a00d9ed64e1675315477aca44908148b9b572c7de45d420398193dcfc2d430d158</div>
</div><!-- fragment --><p >To encode this, the node has to encode the number of transactions (0x00000002), and then append the transactions size and txdata in a ordered manner.</p>
<p >The result Message would be <code>0x01adf01827349cad810003000000020000006df86ba4cfffe74621e0caa14dfcb67a6f263391f4a6ad957ace256f3e706b6da07517a63295165701823f44a08cfdf3826149ca0317eaf4f5832c867a4f5050e3e70d635323947d61a4f35618a07dbe86e6a8cef509c7c6174cb8c703ddd8cb695511d72043630d99888ff2ba200000006df86ba4cfffe74621e0caa14dfcb67a6f263391f4a6ad957ace256f3e706b6da07517a63295165701823f44a01545c0c89ad5fda9e4c6ef65f264ef575fa2edebef29d577f88d365ff9d28357a00d9ed64e1675315477aca44908148b9b572c7de45d420398193dcfc2d430d158</code></p>
<hr  />
 <h2><a class="anchor" id="autotoc_md20"></a>
BroadcastValidatorTx</h2>
<p >Broadcast a given <a class="el" href="classTxValidator.html" title="Abstraction of a Validator transaction.">TxValidator</a> to all know nodes connected to us, they should validate and rebroadcast</p>
<p >BroadcastValidatorTx command ID: \x00\x04</p>
<p >Request Type: Broadcast Only</p>
<p >Payload: TxRLP</p>
<p >Example:</p>
<div class="fragment"><div class="line"> {0x02adf01827349cad810004f86ba4cfffe74621e0caa14dfcb67a6f263391f4a6ad957ace256f3e706b6da07517a63295165701823f44a01545c0c89ad5fda9e4c6ef65f264ef575fa2edebef29d577f88d365ff9d28357a00d9ed64e1675315477aca44908148b9b572c7de45d420398193dcfc2d430d158```}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">### BroadcastTx</div>
<div class="line"> </div>
<div class="line">Broadcast a given TxBlock to all know nodes connected to us, they should validate and rebroadcast</div>
<div class="line"> </div>
<div class="line">BroadcastTx command ID: \x00\x05</div>
<div class="line"> </div>
<div class="line">Request Type: Broadcast Only</div>
<div class="line"> </div>
<div class="line">Payload: TxRLP</div>
<div class="line"> </div>
<div class="line">Example:</div>
<div class="line"> </div>
<div class="line">```0x02adf01827349cad810005f86b02851087ee060082520894f137c97b1345f0a7ec97d070c70cf96a3d71a1c9871a204f293018008025a0d738fcbf48d672da303e56192898a36400da52f26932dfe67b459238ac86b551a00a60deb51469ae5b0dc4a9dd702bad367d1111873734637d428626640bcef15c</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md21"></a>
BroadcastBlock</h2>
<p >Broadcast a given <a class="el" href="classBlock.html" title="Abstraction of a block.">Block</a> to all know nodes connected to us, they should validate and rebroadcast</p>
<p >BroadcastBlock command ID: \x00\x06</p>
<p >Request Type: Broadcast Only</p>
<p >Payload: BlockRLP</p>
<p >Example:</p>
<p ><code>0x02adf01827349cad81000618395ff0c8ee38a250b9e7aeb5733c437fed8d6ca2135fa634367bb288a3830a3c624e33401a1798ce09f049fb6507adc52b085d0a83dacc43adfa519c1228e70122143e16db549af9ccfd3b746ea4a74421847fa0fe7e0e278626a4e7307ac0f600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000186c872a48300000000057de95400000000000000d918395ff0c8ee38a250b9e7aeb5733c437fed8d6ca2135fa634367bb288a3830a3c624e33401a1798ce09f049fb6507adc52b085d0a83dacc43adfa519c1228e70122143e16db549af9ccfd3b746ea4a74421847fa0fe7e0e278626a4e7307ac0f600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000186c872a48300000000057de95400000000000000d9</code> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
